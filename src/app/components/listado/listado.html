<div class="listado">
  <header class="header">
    <a routerLink="/" class="back-link">‚Üê Volver al Dashboard</a>
    <h1>üìã Listado de Clientes</h1>
    @if (filterLabel) {
      <div class="filter-badge">{{ filterLabel }}</div>
    }
  </header>

  @if (data.length === 0) {
    <div class="empty-state">
      <p>No hay datos cargados</p>
      <a routerLink="/" class="btn btn-primary">Cargar archivo Excel</a>
    </div>
  } @else {
    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <input 
          type="text" 
          placeholder="üîç Buscar por raz√≥n social, RFC, gerencia, email..."
          [(ngModel)]="searchTerm"
          (input)="applyFilters()">
      </div>
      
      <div class="filter-group">
        <select [(ngModel)]="filterCsd" (change)="applyFilters()">
          <option value="">Todos los CSD</option>
          <option value="Activo">Activo</option>
          <option value="Inactivo">Inactivo</option>
        </select>
      </div>

      <div class="filter-group">
        <select [(ngModel)]="filterRegimen" (change)="applyFilters()">
          <option value="">Todos los reg√≠menes</option>
          @for (regimen of regimenes; track regimen) {
            <option [value]="regimen">{{ regimen }}</option>
          }
        </select>
      </div>
      
      <button class="btn btn-secondary" (click)="exportToCSV()">
        üì• Exportar CSV
      </button>
    </div>

    <p class="results-count">
      Mostrando {{ filteredData.length }} de {{ data.length }} registros
    </p>

    <!-- Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th (click)="sortData('id')" class="sortable">
              ID
              @if (sortColumn === 'id') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('razonSocial')" class="sortable">
              Raz√≥n Social
              @if (sortColumn === 'razonSocial') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('rfc')" class="sortable">
              RFC
              @if (sortColumn === 'rfc') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('gerencia')" class="sortable">
              Gerencia
              @if (sortColumn === 'gerencia') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('regimen')" class="sortable">
              R√©gimen
              @if (sortColumn === 'regimen') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('csd')" class="sortable">
              CSD
              @if (sortColumn === 'csd') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('expCsd')" class="sortable">
              Exp. CSD
              @if (sortColumn === 'expCsd') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th (click)="sortData('fechaFirma')" class="sortable">
              Fecha Firma
              @if (sortColumn === 'fechaFirma') {
                <span class="sort-icon">{{ sortDirection === 'asc' ? '‚Üë' : '‚Üì' }}</span>
              }
            </th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody>
          @for (item of filteredData; track item.id || item.rfc || $index) {
            <tr>
              <td>{{ item.id }}</td>
              <td class="razon-social-cell" [title]="item.razonSocial">{{ item.razonSocial }}</td>
              <td>{{ item.rfc }}</td>
              <td>{{ item.gerencia }}</td>
              <td>
                <span class="regimen-badge" [ngClass]="getRegimenClass(item.regimen)">
                  {{ getRegimenShort(item.regimen) }}
                </span>
              </td>
              <td>
                <span class="status-badge" [ngClass]="getCsdClass(item.csd)">
                  {{ item.csd || 'N/A' }}
                </span>
              </td>
              <td>{{ item.expCsd }}</td>
              <td>{{ item.fechaFirma }}</td>
              <td>
                @if (item.email) {
                  <a [href]="'mailto:' + item.email" class="email-link">{{ item.email }}</a>
                } @else {
                  <span class="no-data">‚Äî</span>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>
