<div class="dashboard">
  <header class="header">
    <h1>ğŸ“Š Dashboard Reporte Diverza</h1>
    <p>Ãšltima actualizaciÃ³n: <span>{{ lastUpdate }}</span></p>
  </header>

  <!-- Upload Section -->
  <div 
    class="upload-section" 
    [class.dragover]="isDragOver"
    [class.has-data]="hasData"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="fileInput.click()">
    
    <input 
      #fileInput 
      type="file" 
      accept=".xlsx,.xls" 
      (change)="onFileSelect($event)" 
      hidden>
    
    <div class="upload-icon">ğŸ“</div>
    
    @if (isLoading) {
      <p class="upload-text">Procesando archivo...</p>
      <div class="spinner"></div>
    } @else if (hasData) {
      <p class="upload-text">âœ… <strong>{{ fileName }}</strong> cargado correctamente</p>
      <p class="upload-hint">Haz clic para cargar otro archivo</p>
    } @else {
      <p class="upload-text">Arrastra tu archivo Excel aquÃ­ o <strong>haz clic</strong> para seleccionar</p>
      <p class="upload-hint">Se leerÃ¡ la hoja "Reporte Diverza" automÃ¡ticamente</p>
    }
    
    @if (errorMessage) {
      <p class="error-message">{{ errorMessage }}</p>
    }
  </div>

  <!-- KPIs Section -->
  @if (stats) {
    <div class="kpi-container">
      <a routerLink="/listado" [queryParams]="{filtro: 'todos'}" class="kpi-card total">
        <div class="kpi-value">{{ stats.totalRegistros }}</div>
        <div class="kpi-label">Total Registros</div>
        <div class="kpi-hint">Click para ver listado â†’</div>
      </a>
      
      <a routerLink="/listado" [queryParams]="{filtro: 'activos'}" class="kpi-card active">
        <div class="kpi-value">{{ stats.csdActivos }}</div>
        <div class="kpi-label">CSD Activos</div>
        <div class="kpi-hint">Click para ver listado â†’</div>
      </a>
      
      <a routerLink="/listado" [queryParams]="{filtro: 'inactivos'}" class="kpi-card inactive">
        <div class="kpi-value">{{ stats.csdInactivos }}</div>
        <div class="kpi-label">CSD Inactivos</div>
        <div class="kpi-hint">Click para ver listado â†’</div>
      </a>
      
      <a routerLink="/listado" [queryParams]="{filtro: 'pendientes'}" class="kpi-card pending">
        <div class="kpi-value">{{ stats.pendientesFirma }}</div>
        <div class="kpi-label">Pendientes Firma</div>
        <div class="kpi-hint">Click para ver listado â†’</div>
      </a>
    </div>

    <!-- Charts Section -->
    <div class="charts-container">
      <div class="chart-card">
        <h3>ğŸ“… Registros por Mes de Firma</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="mesFirmaChartData"
            [type]="barChartType"
            [options]="chartOptions">
          </canvas>
        </div>
        <p class="chart-hint">Haz clic en una barra para ver el listado del mes</p>
      </div>

      <div class="chart-card">
        <h3>ğŸ¢ DistribuciÃ³n por Gerencia</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="gerenciaChartData"
            [type]="pieChartType"
            [options]="pieChartOptions">
          </canvas>
        </div>
        <p class="chart-hint">Haz clic para ver el listado de cada gerencia</p>
      </div>

      <div class="chart-card">
        <h3>ğŸ“‹ DistribuciÃ³n por RÃ©gimen Fiscal</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="regimenChartData"
            [type]="pieChartType"
            [options]="pieChartOptions">
          </canvas>
        </div>
        <p class="chart-hint">Haz clic para filtrar por rÃ©gimen</p>
      </div>

      <div class="chart-card">
        <h3>â° ExpiraciÃ³n de CSD</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="expiracionChartData"
            [type]="barChartType"
            [options]="chartOptions">
          </canvas>
        </div>
        <p class="chart-hint">Monitorea las fechas de vencimiento</p>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <a routerLink="/listado" class="btn btn-primary">
        ğŸ“‹ Ver Listado Completo
      </a>
    </div>
  }

  <div class="footer">
    <p>Dashboard generado por Sam ğŸ› ï¸ | Grupo Bituaj - Click Seguros</p>
  </div>
</div>
